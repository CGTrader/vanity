
<%=
begin 
  data = Vanity::Metric.data(metric, Date.today - 89, Date.today,  { experiment_id: experiment_id, alternative: alternative  })
  min, max = data.map(&:last).minmax
  js = data.map { |date,value| "['#{date.to_time.httpdate}',#{value}]" }.join(",")
  vanity_html_safe(%{<div class="chart"></div>
    <script type="text/javascript">
    $(function(){Vanity.metric("#{vanity_h id.to_s}").plot([{label:"#{vanity_h metric.name}", data: [#{js}]}])})
    </script>})
rescue Exception=>ex
  %{<div class="error">#{vanity_h ex.message}</div>}
end %>
